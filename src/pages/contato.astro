---
import BaseLayout from "../layouts/BaseLayout.astro";

const formEndpoint = import.meta.env.PUBLIC_CONTACT_FORM_ENDPOINT ?? "";
---

<BaseLayout title="Contato | LAPAN" description="Página de contato institucional do laboratório.">
  <section class="grid gap-8 xl:grid-cols-[0.9fr_1.1fr] xl:items-start">
    <div>
      <p class="text-xs font-semibold uppercase tracking-[0.14em] text-accent-700">Fale conosco</p>
      <h1 class="mt-3 text-4xl text-brand-900 sm:text-5xl">Contato</h1>
      <p class="mt-5 text-base leading-relaxed text-neutral-700">
        A página original incluía um formulário de mensagem. O formulário abaixo mantém os mesmos campos e
        pode enviar diretamente para o endpoint configurado pelo projeto.
      </p>

      <div class="mt-8 rounded-2xl border border-brand-200 bg-surface p-5 shadow-soft">
        <h2 class="text-xl text-brand-900">Local</h2>
        <address class="mt-3 not-italic text-sm leading-relaxed text-neutral-700">
          Faculdade de Engenharia da Universidade Federal de Minas Gerais (UFMG)<br />
          Avenida Antônio Carlos, 6627 - Pampulha<br />
          Belo Horizonte - MG, Brasil
        </address>
        <p class="mt-3 text-sm text-neutral-700">
          E-mail institucional: <a href="mailto:contato@lapan.org.br" class="font-semibold text-accent-700">contato@lapan.org.br</a>
        </p>
      </div>

      <div class="mt-8 overflow-hidden rounded-2xl border border-brand-200 bg-surface shadow-soft">
        <iframe
          title="Mapa da UFMG - endereço do laboratório"
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3752.310940841378!2d-43.966384!3d-19.869087999999998!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xa690ee806be67d%3A0xbb1391cea62811dd!2sUniversidade+Federal+de+Minas+Gerais!5e0!3m2!1spt-BR!2sbr!4v1434131292053"
          class="h-[360px] w-full"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
        ></iframe>
      </div>
    </div>

    <div>
      <div class="rounded-2xl border border-brand-200 bg-surface p-6 shadow-soft">
        <h2 class="text-2xl text-brand-900">Envie sua mensagem</h2>
        <p class="mt-2 text-sm leading-relaxed text-neutral-700">
          Campos obrigatórios: nome, e-mail, assunto e mensagem.
        </p>

        <form
          id="contato-form"
          class="mt-5 space-y-4"
          method="post"
          action={formEndpoint || "#"}
          data-endpoint={formEndpoint}
          novalidate
        >
          <input type="hidden" name="_subject" value="Contato pelo site do LAPAN" />

          <div>
            <label for="your-name" class="mb-1 block text-sm font-semibold text-brand-800">Nome</label>
            <input
              id="your-name"
              name="your-name"
              type="text"
              autocomplete="name"
              required
              class="w-full rounded-md border border-brand-200 bg-surface px-3 py-2 text-sm text-ink transition focus:border-accent-500 focus:outline-none"
            />
          </div>

          <div>
            <label for="your-email" class="mb-1 block text-sm font-semibold text-brand-800">E-mail</label>
            <input
              id="your-email"
              name="your-email"
              type="email"
              autocomplete="email"
              required
              class="w-full rounded-md border border-brand-200 bg-surface px-3 py-2 text-sm text-ink transition focus:border-accent-500 focus:outline-none"
            />
          </div>

          <div>
            <label for="your-subject" class="mb-1 block text-sm font-semibold text-brand-800">Assunto</label>
            <input
              id="your-subject"
              name="your-subject"
              type="text"
              required
              class="w-full rounded-md border border-brand-200 bg-surface px-3 py-2 text-sm text-ink transition focus:border-accent-500 focus:outline-none"
            />
          </div>

          <div>
            <label for="your-message" class="mb-1 block text-sm font-semibold text-brand-800">Mensagem</label>
            <textarea
              id="your-message"
              name="your-message"
              rows="6"
              required
              maxlength="2000"
              class="w-full rounded-md border border-brand-200 bg-surface px-3 py-2 text-sm text-ink transition focus:border-accent-500 focus:outline-none"
            ></textarea>
          </div>

          <p id="form-status" class="text-sm text-neutral-700" aria-live="polite"></p>

          <button
            type="submit"
            class="inline-flex items-center rounded-md bg-accent-500 px-5 py-2.5 text-sm font-semibold text-surface transition duration-200 hover:bg-accent-600"
          >
            Enviar
          </button>
        </form>
      </div>
    </div>
  </section>

  <script is:inline>
    const form = document.querySelector("#contato-form");
    const status = document.querySelector("#form-status");

    if (form && status) {
      form.addEventListener("submit", async (event) => {
        const endpoint = form.getAttribute("data-endpoint");
        if (!endpoint) {
          event.preventDefault();
          status.textContent = "Envio online ainda não configurado. Utilize o e-mail contato@lapan.org.br.";
          status.className = "text-sm text-accent-700";
          return;
        }

        if (!form.reportValidity()) {
          event.preventDefault();
          status.textContent = "Revise os campos obrigatórios antes de enviar.";
          status.className = "text-sm text-accent-700";
          return;
        }

        event.preventDefault();
        status.textContent = "Enviando mensagem...";
        status.className = "text-sm text-neutral-700";

        const formData = new FormData(form);
        const data = new URLSearchParams();
        for (const [key, value] of formData.entries()) {
          data.append(key, String(value));
        }

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: data.toString(),
          });

          if (!response.ok) {
            throw new Error("Falha no envio");
          }

          form.reset();
          status.textContent = "Mensagem enviada com sucesso.";
          status.className = "text-sm text-brand-800";
        } catch {
          status.textContent = "Não foi possível enviar agora. Tente novamente ou use contato@lapan.org.br.";
          status.className = "text-sm text-accent-700";
        }
      });
    }
  </script>
</BaseLayout>
