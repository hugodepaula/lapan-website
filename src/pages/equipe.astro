---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

const ordemTipos = ["Pesquisador", "Doutorado", "Mestrado", "Iniciação Científica", "Colaborador"];
const membros = await getCollection("team");

const membrosOrdenados = [...membros].sort((a, b) => {
  const tipoA = ordemTipos.indexOf(a.data.tipo);
  const tipoB = ordemTipos.indexOf(b.data.tipo);
  if (tipoA !== tipoB) return tipoA - tipoB;
  return a.data.nome.localeCompare(b.data.nome, "pt-BR");
});

const grupos = ordemTipos
  .map((tipo) => ({ tipo, itens: membrosOrdenados.filter((item) => item.data.tipo === tipo) }))
  .filter((grupo) => grupo.itens.length > 0);
---

<BaseLayout title="Equipe | LAPAN" description="Equipe do laboratório organizada por nível e função acadêmica.">
  <section>
    <p class="text-xs font-semibold uppercase tracking-[0.14em] text-accent-700">Pessoas</p>
    <h1 class="mt-3 text-4xl text-brand-900 sm:text-5xl">Equipe</h1>
    <p class="mt-4 max-w-3xl text-base leading-relaxed text-neutral-700">
      Esta página é alimentada pelo Decap CMS e pode ser atualizada por perfis não técnicos.
    </p>
  </section>

  {grupos.length === 0 ? (
    <section class="mt-8 rounded-2xl border border-brand-200 bg-surface p-6">
      <p class="text-neutral-700">Nenhum membro cadastrado no momento.</p>
    </section>
  ) : (
    grupos.map((grupo) => (
      <section class="pt-12">
        <h2 class="text-2xl text-brand-900">{grupo.tipo}</h2>
        <div class="mt-5 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {grupo.itens.map((membro) => (
            <article class="rounded-2xl border border-brand-200 bg-surface p-5 shadow-soft">
              <img
                src={membro.data.foto || "/images/logo_squared.png"}
                alt={`Foto de ${membro.data.nome}`}
                class="h-44 w-full rounded-xl object-cover"
                loading="lazy"
                decoding="async"
              />
              <h3 class="mt-4 text-xl text-brand-900">{membro.data.nome}</h3>
              <p class="text-sm font-semibold text-accent-700">{membro.data.cargo}</p>
              <p class="mt-2 text-sm leading-relaxed text-neutral-700">{membro.data.bio}</p>

              {membro.data.links.length > 0 && (
                <ul class="mt-4 flex flex-wrap gap-2">
                  {membro.data.links.map((link) => (
                    <li>
                      <a
                        href={link.url}
                        target="_blank"
                        rel="noreferrer"
                        class="inline-flex rounded-md border border-brand-200 px-2.5 py-1 text-xs font-semibold text-brand-700 transition hover:border-brand-400 hover:bg-brand-50"
                      >
                        {link.rotulo}
                      </a>
                    </li>
                  ))}
                </ul>
              )}
            </article>
          ))}
        </div>
      </section>
    ))
  )}
</BaseLayout>
