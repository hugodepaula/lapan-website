---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

const projetos = (await getCollection("projects")).slice(0, 3);
const eventos = [...(await getCollection("events"))]
  .sort((a, b) => new Date(a.data.data).getTime() - new Date(b.data.data).getTime())
  .slice(0, 3);
const equipe = (await getCollection("team")).slice(0, 3);

const metricas = [
  { rotulo: "Projetos interdisciplinares", valor: projetos.length > 0 ? String(projetos.length) : "+30" },
  { rotulo: "Eventos cadastrados", valor: eventos.length > 0 ? String(eventos.length) : "+20" },
  { rotulo: "Membros em destaque", valor: equipe.length > 0 ? String(equipe.length) : "+15" }
];
---

<BaseLayout
  title="LAPAN | Início"
  description="Laboratório acadêmico com atuação em pesquisa aplicada, formação e extensão."
>
  <section class="relative overflow-hidden rounded-3xl border border-brand-200 bg-surface p-6 shadow-soft sm:p-8 lg:p-12">
    <div class="absolute -right-16 -top-16 h-48 w-48 rounded-full bg-accent-100 blur-3xl" aria-hidden="true"></div>
    <div class="absolute -bottom-20 left-0 h-48 w-48 rounded-full bg-brand-100 blur-3xl" aria-hidden="true"></div>

    <div class="relative grid gap-8 lg:grid-cols-[1.2fr_0.8fr] lg:items-end">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.14em] text-accent-700">Pesquisa aplicada em neurociência</p>
        <h1 class="mt-3 text-4xl leading-tight text-brand-900 sm:text-5xl">
          Produzimos ciência confiável para decisões reais.
        </h1>
        <p class="mt-4 max-w-2xl text-lg leading-relaxed text-neutral-700">
          O LAPAN integra pesquisa, ensino e extensão em um ecossistema acadêmico contemporâneo, com foco em método,
          clareza e impacto social.
        </p>
        <div class="mt-7 flex flex-wrap gap-3">
          <a
            href="/projetos"
            class="inline-flex items-center rounded-md bg-accent-500 px-5 py-2.5 text-sm font-semibold text-surface transition duration-200 hover:bg-accent-600"
          >
            Explorar projetos
          </a>
          <a
            href="/eventos"
            class="inline-flex items-center rounded-md border border-brand-200 bg-surface px-5 py-2.5 text-sm font-semibold text-brand-700 transition duration-200 hover:border-brand-400 hover:bg-brand-50"
          >
            Ver agenda de eventos
          </a>
        </div>
      </div>

      <aside class="rounded-2xl border border-brand-200 bg-brand-50 p-5">
        <p class="text-xs uppercase tracking-[0.1em] text-brand-600">Indicadores</p>
        <dl class="mt-4 space-y-4">
          {metricas.map((item) => (
            <div class="border-b border-brand-200 pb-3 last:border-0 last:pb-0">
              <dt class="text-sm text-neutral-700">{item.rotulo}</dt>
              <dd class="mt-1 text-2xl font-semibold text-brand-900">{item.valor}</dd>
            </div>
          ))}
        </dl>
      </aside>
    </div>
  </section>

  <section id="projetos" class="pt-16">
    <div class="flex items-end justify-between gap-4">
      <h2 class="text-3xl text-brand-900">Projetos</h2>
      <a href="/projetos" class="text-sm font-semibold text-accent-700 transition hover:text-accent-600">Ver todos</a>
    </div>
    <div class="mt-6 grid gap-4 md:grid-cols-3">
      {projetos.length > 0 ? (
        projetos.map((projeto) => (
          <article class="rounded-2xl border border-brand-200 bg-surface p-5 transition duration-200 hover:-translate-y-0.5 hover:shadow-soft">
            <h3 class="text-xl text-brand-900">{projeto.data.titulo}</h3>
            <p class="mt-2 text-sm leading-relaxed text-neutral-700">{projeto.data.resumo}</p>
          </article>
        ))
      ) : (
        <p class="text-neutral-700 md:col-span-3">Nenhum projeto cadastrado no CMS.</p>
      )}
    </div>
  </section>

  <section id="eventos" class="pt-16">
    <div class="flex items-end justify-between gap-4">
      <h2 class="text-3xl text-brand-900">Eventos</h2>
      <a href="/eventos" class="text-sm font-semibold text-accent-700 transition hover:text-accent-600">Ver agenda completa</a>
    </div>
    <div class="mt-6 grid gap-4 md:grid-cols-3">
      {eventos.length > 0 ? (
        eventos.map((evento) => (
          <article class="rounded-2xl border border-brand-200 bg-surface p-5 transition duration-200 hover:-translate-y-0.5 hover:shadow-soft">
            <p class="text-xs font-semibold uppercase tracking-[0.08em] text-accent-700">
              {new Intl.DateTimeFormat("pt-BR", { day: "2-digit", month: "short", year: "numeric" }).format(new Date(evento.data.data))}
            </p>
            <h3 class="mt-2 text-xl text-brand-900">{evento.data.titulo}</h3>
            <p class="mt-1 text-sm font-semibold text-neutral-700">{evento.data.local}</p>
          </article>
        ))
      ) : (
        <p class="text-neutral-700 md:col-span-3">Nenhum evento cadastrado no CMS.</p>
      )}
    </div>
  </section>

  <section id="equipe" class="pt-16">
    <div class="flex items-end justify-between gap-4">
      <h2 class="text-3xl text-brand-900">Equipe</h2>
      <a href="/equipe" class="text-sm font-semibold text-accent-700 transition hover:text-accent-600">Ver equipe completa</a>
    </div>
    <div class="mt-6 grid gap-4 md:grid-cols-3">
      {equipe.length > 0 ? (
        equipe.map((membro) => (
          <article class="rounded-2xl border border-brand-200 bg-surface p-5 transition duration-200 hover:-translate-y-0.5 hover:shadow-soft">
            <h3 class="text-xl text-brand-900">{membro.data.nome}</h3>
            <p class="mt-1 text-sm font-semibold text-accent-700">{membro.data.cargo}</p>
            <p class="mt-2 text-sm leading-relaxed text-neutral-700">{membro.data.tipo}</p>
          </article>
        ))
      ) : (
        <p class="text-neutral-700 md:col-span-3">Nenhum membro cadastrado no CMS.</p>
      )}
    </div>
  </section>

  <section id="publicacoes" class="pt-16">
    <h2 class="text-3xl text-brand-900">Publicações</h2>
    <p class="mt-4 max-w-3xl text-base leading-relaxed text-neutral-700">
      As publicações continuam sendo carregadas a partir da base atual (`content/zotero.json`) nesta etapa.
    </p>
  </section>
</BaseLayout>
